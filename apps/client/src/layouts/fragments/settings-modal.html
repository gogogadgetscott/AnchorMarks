<div id="settings-modal" class="modal hidden">
  <div class="modal-backdrop"></div>
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h2>Settings</h2>
      <div style="display: flex; gap: 0.75rem; align-items: center">
        <button
          class="btn btn-sm btn-outline-danger"
          id="logout-btn"
          style="padding: 0.25rem 0.75rem; font-size: 0.8rem"
        >
          Logout
        </button>
        <button class="btn-icon modal-close">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
    </div>
    <div class="settings-content">
      <div class="settings-tabs">
        <button class="settings-tab" data-settings-tab="profile">
          Profile
        </button>
        <button class="settings-tab active" data-settings-tab="general">
          General
        </button>
        <button class="settings-tab" data-settings-tab="api">API Access</button>
        <button class="settings-tab" data-settings-tab="sync">
          Browser Helper
        </button>
        <button class="settings-tab" data-settings-tab="import">
          Import/Export
        </button>
        <button class="settings-tab" data-settings-tab="tags">Tags</button>
        <button class="settings-tab" data-settings-tab="maintenance">
          Maintenance
        </button>
        <button class="settings-tab" data-settings-tab="shortcuts">
          Keyboard Shortcuts
        </button>
      </div>

      <div class="settings-panel" id="settings-profile">
        <!-- Profile forms injected dynamically to avoid password manager conflicts -->
      </div>

      <div class="settings-panel active" id="settings-general">
        <div class="setting-item">
          <div class="setting-info">
            <h4>Theme</h4>
            <p>Choose your preferred color theme</p>
          </div>
          <select
            id="theme-select"
            style="
              padding: 0.5rem;
              border: 1px solid var(--border-color);
              border-radius: var(--radius-md);
              background: var(--bg-primary);
              color: var(--text-primary);
            "
          >
            <option value="system">System</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="ocean">Ocean</option>
            <option value="sunset">Sunset</option>
            <option value="midnight">Midnight</option>
            <option value="high-contrast">High Contrast</option>
          </select>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>Hide Favicons</h4>
            <p>Disable favicon images for privacy and faster loading</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="hide-favicons-toggle" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>Enable Rich Link Previews</h4>
            <p>Show card view with images for links when available</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="rich-link-previews-toggle" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>AI Tag Suggestions</h4>
            <p>Use AI-powered tag suggestions when adding bookmarks</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="ai-suggestions-toggle" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>Include Child Bookmarks</h4>
            <p>
              Show bookmarks from sub-folders in main view and dashboard widgets
            </p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="include-children-toggle" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>Onboarding Tour</h4>
            <p>Restart the guided tour if you skipped it</p>
          </div>
          <button class="btn btn-outline" id="restart-tour-btn">
            Restart Tour
          </button>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <h4>Reset to Example Bookmarks</h4>
            <p>Clear all bookmarks and restore the default starter bookmarks</p>
          </div>
          <button class="btn btn-outline" id="reset-bookmarks-btn">
            Reset Bookmarks
          </button>
        </div>
      </div>

      <div class="settings-panel" id="settings-api">
        <div class="api-section">
          <h4>Your API Key</h4>
          <p>
            Use this key to access your bookmarks from external applications
            like Flow Launcher
          </p>
          <div class="api-key-display">
            <code id="api-key-value">Loading...</code>
            <button class="btn btn-secondary" id="copy-api-key">Copy</button>
          </div>
          <button class="btn btn-outline" id="regenerate-api-key">
            Regenerate Key
          </button>
        </div>
        <div class="api-section">
          <h4>API Documentation</h4>
          <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/api/quick-search?q=query</code>
            <p>Search bookmarks (optimized for Flow Launcher)</p>
          </div>
          <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/api/bookmarks</code>
            <p>Get all bookmarks</p>
          </div>
          <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/api/bookmarks</code>
            <p>Create a new bookmark</p>
          </div>
          <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/api/folders</code>
            <p>Get all folders</p>
          </div>
        </div>
      </div>

      <div class="settings-panel" id="settings-sync">
        <div class="setting-item">
          <div class="setting-info">
            <h4>Bookmark Button Shortcut</h4>
            <p>
              Drag the button below to your browser's Bookmarks Bar (<a
                href="#"
                id="bookmark-help-link"
                style="
                  color: var(--link-color);
                  text-decoration: underline;
                  cursor: pointer;
                "
                >click here for Help</a
              >)
            </p>
          </div>
          <div
            id="bookmark-buttons-container"
            style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem"
          >
            <a
              id="add-bookmark-button"
              href="javascript:void(0)"
              class="btn btn-secondary"
              draggable="true"
              title="Drag this button to your browser's bookmarks bar to add bookmarks quickly"
              style="cursor: grab; user-select: none"
              >üìå Add to AnchorMarks</a
            >
          </div>
          <div
            id="bookmark-shortcut-status"
            style="
              margin-top: 1rem;
              font-size: 0.85rem;
              display: none;
              padding: 0.5rem;
              background: var(--bg-secondary);
              border-radius: var(--radius-md);
            "
          >
            <span id="shortcut-status-text"></span>
          </div>
        </div>
      </div>

      <div class="settings-panel" id="settings-import">
        <div class="import-section">
          <h4>Import Bookmarks</h4>
          <p>Import bookmarks from your browser or other bookmark managers</p>
          <div class="import-options">
            <div class="import-option">
              <input
                type="file"
                id="import-html-file"
                accept=".html,.htm"
                hidden
              />
              <button class="btn btn-secondary" id="import-html-btn">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="17 8 12 3 7 8" />
                  <line x1="12" y1="3" x2="12" y2="15" />
                </svg>
                Import HTML (Browser Export)
              </button>
              <div
                id="import-html-progress"
                class="import-progress"
                aria-live="polite"
              ></div>
            </div>

            <div class="import-option">
              <input
                type="file"
                id="import-json-file"
                accept=".json,.tson"
                hidden
              />
              <button class="btn btn-secondary" id="import-json-btn">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="17 8 12 3 7 8" />
                  <line x1="12" y1="3" x2="12" y2="15" />
                </svg>
                Import JSON (AnchorMarks Format)
              </button>
              <div
                id="import-json-progress"
                class="import-progress"
                aria-live="polite"
              ></div>
            </div>
          </div>
        </div>
        <div class="import-section">
          <h4>Export Bookmarks</h4>
          <p>Download your bookmarks for backup or transfer</p>
          <div class="export-options">
            <button class="btn btn-secondary" id="export-json-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Export as JSON
            </button>
            <button class="btn btn-secondary" id="export-html-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Export as HTML
            </button>
          </div>
        </div>
        <div class="import-section">
          <h4>Saved Views</h4>
          <p>Export or import your saved views</p>
          <div class="export-options">
            <button class="btn btn-secondary" id="export-views-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Export Views
            </button>
            <input type="file" id="import-views-file" accept=".json" hidden />
            <button class="btn btn-secondary" id="import-views-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
              </svg>
              Import Views
            </button>
            <div
              id="import-views-progress"
              class="import-progress"
              aria-live="polite"
            ></div>
          </div>
        </div>
      </div>

      <div class="settings-panel" id="settings-tags">
        <div class="setting-item" style="display: block">
          <div class="setting-info" style="margin-bottom: 10px">
            <h4>Tag Overview</h4>
            <p>See your tags, counts, and nested paths</p>
          </div>
          <input
            type="text"
            id="tag-search-input"
            class="form-input"
            placeholder="Search tags..."
            style="margin-bottom: 10px"
          />
          <div id="tag-stats-list" class="tag-stats-list"></div>

          <div class="setting-item" style="margin-top: 1.5rem">
            <div class="setting-info">
              <h4>Add New Tag</h4>
              <p>Create a new tag to organize your bookmarks.</p>
            </div>
            <div
              style="
                display: flex;
                gap: 0.5rem;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <input
                type="text"
                id="new-tag-name"
                class="form-input"
                placeholder="Tag name"
                style="width: 200px"
              />
              <input
                type="color"
                id="new-tag-color"
                class="form-input"
                value="#f59e0b"
                style="width: 60px; height: 38px; padding: 2px"
              />
              <button class="btn btn-primary" id="add-new-tag-btn">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  style="width: 16px; height: 16px"
                >
                  <line x1="12" y1="5" x2="12" y2="19" />
                  <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                Add Tag
              </button>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <h4>Sort Tags</h4>
              <p>Choose your preferred order for the tag list.</p>
            </div>
            <select
              id="settings-tag-sort"
              class="form-input"
              style="width: auto"
            >
              <option value="count_desc">Most used first</option>
              <option value="count_asc">Least used first</option>
              <option value="name_asc">A ‚Üí Z</option>
              <option value="name_desc">Z ‚Üí A</option>
            </select>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <h4>Tag Cloud</h4>
              <p>Control how many tags are shown in the Tag Cloud.</p>
            </div>
            <div
              style="
                display: flex;
                gap: 0.75rem;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <label
                for="tag-cloud-max-tags"
                class="text-tertiary"
                style="font-size: 0.9rem"
                >Max tags (desktop)</label
              >
              <input
                type="number"
                id="tag-cloud-max-tags"
                class="form-input"
                min="20"
                max="500"
                step="10"
                style="width: 110px"
              />
              <label class="toggle" style="margin-left: 0.5rem">
                <input type="checkbox" id="tag-cloud-default-show-all" />
                <span class="toggle-slider"></span>
              </label>
              <span class="text-tertiary" style="font-size: 0.9rem"
                >Show all tags by default</span
              >
            </div>
            <p
              class="text-tertiary"
              style="margin-top: 0.5rem; font-size: 0.85rem"
            >
              On smaller screens, this limit scales down automatically.
            </p>
          </div>
        </div>

        <!-- Tags Section (Hidden - moved to filter dropdown) -->
        <div class="nav-section collapsible hidden" id="tags-section">
          <div class="setting-info" style="margin-bottom: 10px">
            <h4>Merge / Rename Tag</h4>
            <p>
              Move all uses of one tag to another (use ‚Äúparent/child‚Äù for
              hierarchy)
            </p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="tag-rename-from">From</label>
              <input type="text" id="tag-rename-from" placeholder="old tag" />
            </div>
            <div class="form-group">
              <label for="tag-rename-to">To</label>
              <input
                type="text"
                id="tag-rename-to"
                placeholder="new tag (can be nested)"
              />
            </div>
          </div>
          <div style="display: flex; gap: 0.5rem; align-items: center">
            <button class="btn btn-primary" id="tag-rename-btn">
              Rename / Merge
            </button>
            <button class="btn btn-ghost" id="tag-rename-undo-btn" disabled>
              Undo last rename
            </button>
            <span class="text-tertiary" style="font-size: 0.9rem"
              >Example: dev/js ‚Üí dev/frontend/js</span
            >
          </div>
        </div>
      </div>

      <div class="settings-panel" id="settings-maintenance">
        <div class="maintenance-section">
          <h4>
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M8 14s1.5 2 4 2 4-2 4-2" />
              <line x1="9" y1="9" x2="9.01" y2="9" />
              <line x1="15" y1="9" x2="15.01" y2="9" />
            </svg>
            Refresh Favicons
          </h4>
          <p>
            Re-fetch favicon images for all bookmarks. Useful if icons are
            missing or outdated.
          </p>
          <div class="maintenance-actions">
            <button class="btn btn-secondary" id="refresh-favicons-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="width: 16px; height: 16px"
              >
                <path d="M21 12a9 9 0 11-6.219-8.56" />
                <polyline points="21 3 21 9 15 9" />
              </svg>
              Refresh All Favicons
            </button>
          </div>
          <div id="favicon-progress" class="maintenance-progress hidden">
            <div class="maintenance-progress-bar">
              <div
                class="maintenance-progress-fill"
                id="favicon-progress-fill"
                style="width: 0%"
              ></div>
            </div>
            <span id="favicon-progress-text">0%</span>
          </div>
        </div>

        <div class="maintenance-section">
          <h4>
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="18" height="18" rx="2" />
              <path d="M9 3v18" />
              <path d="M3 9h18" />
            </svg>
            Find Duplicate Bookmarks
          </h4>
          <p>
            Identify bookmarks with the same URL. You can then choose to keep or
            remove duplicates.
          </p>
          <div class="maintenance-actions">
            <button class="btn btn-secondary" id="find-duplicates-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="width: 16px; height: 16px"
              >
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
              </svg>
              Find Duplicates
            </button>
          </div>
          <div id="duplicates-results" class="maintenance-results hidden">
            <div class="maintenance-results-header">
              <span>Duplicate URLs</span>
              <span id="duplicates-count">0 found</span>
            </div>
            <div id="duplicates-list"></div>
          </div>
        </div>

        <div class="maintenance-section">
          <h4>
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
              />
              <path
                d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
              />
            </svg>
            Check Broken Links
          </h4>
          <p>
            Test all bookmark URLs to find broken or unreachable links. This may
            take a while for large collections.
          </p>
          <div class="maintenance-actions">
            <button class="btn btn-secondary" id="check-links-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="width: 16px; height: 16px"
              >
                <polyline points="9 11 12 14 22 4" />
                <path
                  d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"
                />
              </svg>
              Check All Links
            </button>
            <button
              class="btn btn-outline"
              id="stop-check-links-btn"
              style="display: none"
            >
              Stop
            </button>
          </div>
          <div id="links-progress" class="maintenance-progress hidden">
            <div class="maintenance-progress-bar">
              <div
                class="maintenance-progress-fill"
                id="links-progress-fill"
                style="width: 0%"
              ></div>
            </div>
            <span id="links-progress-text">0 / 0</span>
          </div>
          <div id="broken-links-results" class="maintenance-results hidden">
            <div class="maintenance-results-header">
              <span>Broken Links</span>
              <span id="broken-links-count">0 found</span>
            </div>
            <div id="broken-links-list"></div>
          </div>
        </div>
      </div>

      <div class="settings-panel" id="settings-shortcuts">
        <div class="shortcuts-section">
          <h4>Navigation</h4>
          <table class="shortcuts-table">
            <tr>
              <td><kbd>Ctrl+Shift+D</kbd> / <kbd>Cmd+Shift+D</kbd></td>
              <td>Go to Dashboard</td>
            </tr>
            <tr>
              <td><kbd>Ctrl+Shift+F</kbd> / <kbd>Cmd+Shift+F</kbd></td>
              <td>Go to Favorites</td>
            </tr>
            <tr>
              <td><kbd>Ctrl+Shift+A</kbd> / <kbd>Cmd+Shift+A</kbd></td>
              <td>Go to All Bookmarks</td>
            </tr>
            <tr>
              <td>
                <kbd>Ctrl+1</kbd> to <kbd>Ctrl+9</kbd> / <kbd>Cmd+1</kbd> to
                <kbd>Cmd+9</kbd>
              </td>
              <td>Jump to folder 1-9</td>
            </tr>
          </table>
        </div>
        <div class="shortcuts-section">
          <h4>Bookmarks</h4>
          <table class="shortcuts-table">
            <tr>
              <td><kbd>Ctrl+N</kbd> / <kbd>Cmd+N</kbd></td>
              <td>Add new bookmark</td>
            </tr>
            <tr>
              <td><kbd>Ctrl+F</kbd> / <kbd>Cmd+F</kbd></td>
              <td>Focus search</td>
            </tr>
            <tr>
              <td><kbd>Ctrl+K</kbd> / <kbd>Cmd+K</kbd></td>
              <td>Focus search (alternative)</td>
            </tr>
            <tr>
              <td><kbd>Ctrl+A</kbd> / <kbd>Cmd+A</kbd></td>
              <td>Select all bookmarks</td>
            </tr>
          </table>
        </div>
        <div class="shortcuts-section">
          <h4>General</h4>
          <table class="shortcuts-table">
            <tr>
              <td><kbd>Ctrl+Shift+P</kbd> / <kbd>Cmd+Shift+P</kbd></td>
              <td>Open command palette</td>
            </tr>
            <tr>
              <td><kbd>Esc</kbd></td>
              <td>Close modals and selections</td>
            </tr>
            <tr>
              <td><kbd>‚Üì</kbd> / <kbd>‚Üë</kbd></td>
              <td>Navigate command palette (when open)</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
